(function(w,g){w.HAPAdManager=function(r,p,w,H,c,I,J,K){function x(){c.removeEventListener("loadedmetadata",x,!1);g(k).trigger("HAPAdManager.ADPRE_PLAY");b=c;b.addEventListener("timeupdate",h,!1);h()}function y(){d++;if(d<e.adPre.length){b.src=e.adPre[d];var a=b.play();void 0!==a&&a.then(function(){})["catch"](function(a){})}else b.removeEventListener("timeupdate",h,!1),c.removeEventListener("ended",y,!1),l=!1,d=0,g(k).trigger("HAPAdManager.ADPRE_ENDED")}function D(){u&&!E?E=!0:(z&&(g(k).trigger("HAPAdManager.ADMID_PLAY"),
b=a,b.addEventListener("timeupdate",h,!1)),m=!0,a.volume=A,g(p).trigger("adMidPlay",{instance:p,instanceName:r.instanceName,data:e.adMid}))}function F(){u&&!v?v=!0:(z&&(b.removeEventListener("timeupdate",h,!1),g(k).trigger("HAPAdManager.ADMID_ENDED")),m=!1,g(p).trigger("adMidEnded",{instance:p,instanceName:r.instanceName,data:e.adMid}),t())}function t(){f&&clearTimeout(f);f=setTimeout(function(){f=null;p.getMediaPlaying()&&(d++,d>e.adMid.length-1&&(d=0),a.src=e.adMid[d],a.play())},parseInt(e.adMidInterval||
1E4,10)+r.dataInterval)}function B(){c.removeEventListener("loadedmetadata",B,!1);g(k).trigger("HAPAdManager.ADEND_PLAY");b=c;b.addEventListener("timeupdate",h,!1)}function C(){d++;if(d<e.adEnd.length){b.src=e.adEnd[d];var a=b.play();void 0!==a&&a.then(function(){})["catch"](function(a){})}else b.removeEventListener("timeupdate",h,!1),b.removeEventListener("ended",C,!1),n=!1,g(k).trigger("HAPAdManager.ADEND_ENDED")}function h(){if(l||n)var q=c.currentTime,b=c.duration;else m&&(q=a.currentTime,b=a.duration);
HAPUtils.isNumber(q)&&HAPUtils.isNumber(b)&&(I.width(q/b*G),q=parseInt(b-q,10),J.find("span").html(HAPUtils.formatTime(q)))}var k=this,u=navigator.userAgent.match(/(iPad|iPhone|iPod)/g),z=r.pauseAudioDuringAds,b,l,a,f,m,E,v,n,d=0,e=w,A=H,G=K;g(p).on("volumeChange",function(b,c){A=c.volume;a&&(a.volume=A)});this.initAdPre=function(){l=!0;c.addEventListener("loadedmetadata",x,!1);c.addEventListener("ended",y,!1);c.src=e.adPre[d]};this.forceAdMidAudio=function(){g(k).trigger("HAPAdManager.IOS_ADMID_FIX_START",
!0);a||(a=document.createElement("audio"),a.addEventListener("play",D,!1),a.addEventListener("ended",F,!1));a.src=r.sourcePath+"data/silence.mp3";a.play()};this.adMidStartHandler=function(){a||(a=document.createElement("audio"),a.addEventListener("play",D,!1),a.addEventListener("ended",F,!1));u?v&&t():t()};this.adMidPlayHandler=function(){f||(u?v&&t():t())};this.clearAdMidTimeout=function(){f&&(clearTimeout(f),f=null)};this.toggleAdMidAudio=function(){if(a&&z)if(a.paused){var b=a.play();void 0!==
b&&b.then(function(){})["catch"](function(a){})}else a.pause()};this.setAdEnd=function(){n=!0;d=0;c.addEventListener("loadedmetadata",B,!1);c.addEventListener("ended",C,!1);c.src=e.adEnd[d];var a=c.play();void 0!==a&&a.then(function(){})["catch"](function(a){})};this.isAdOn=function(){return l||m||n};this.isAdPreOn=function(){return l};this.isAdMidOn=function(){return m};this.isAdEndOn=function(){return n};this.setAdData=function(a){e=a;d=0};this.setSeekBarSize=function(a){G=a};this.cleanAds=function(){b&&
b.removeEventListener("timeupdate",h,!1);l&&(c.removeEventListener("loadedmetadata",x,!1),c.removeEventListener("ended",y,!1),l=!1);f&&(clearTimeout(f),f=null);m&&(a&&(a.pause(),a.src=""),m=!1);n&&(c.removeEventListener("loadedmetadata",B,!1),c.removeEventListener("ended",C,!1),n=!1)}}})(window,jQuery);