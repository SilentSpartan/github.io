(function(w,q){w.HAPYoutubeLoader=function(p){function t(a){q.ajax({url:a,dataType:"jsonp"}).done(function(a){if(a.error&&a.error.message)console.log(a.error.message);else{var b,c=a.items.length;(f=a.nextPageToken)&&(f=l+"&pageToken="+f);for(b=0;b<c&&h.length!=m;b++){var d=a.items[b];if("youtube_playlist"==g||"youtube_single"==g||"youtube_single_list"==g)d.status?"public"==d.status.privacyStatus&&h.push(v(d,g)):d.snippet&&"Private video"!=d.snippet.title&&h.push(v(d,g))}if("youtube_single"==g||"youtube_single_list"==
g)q(r).trigger("HAPYoutubeLoader.END_LOAD",{data:h,nextPageToken:f});else if(h.length<m)if(f){h.length+n>m&&(n=m-h.length,a=f.substr(0,l.indexOf("&maxResults=")+12),b=f.substr(l.indexOf("&key=")),f=a+n.toString()+b);if("youtube_playlist"==g)var e=f;t(e)}else q(r).trigger("HAPYoutubeLoader.END_LOAD",{data:h,nextPageToken:f});else q(r).trigger("HAPYoutubeLoader.END_LOAD",{data:h,nextPageToken:f})}}).fail(function(a,b,c){console.log(a,b,c)})}function v(a,e){var b=jQuery.extend(!0,{},k);b.type="youtube";
"youtube_single"==e||"youtube_single_list"==e?b.mp3=a.id:"youtube_playlist"==e&&(b.mp3=a.contentDetails.videoId);a.snippet&&(!b.title&&a.snippet.title&&(b.title=a.snippet.title),!b.description&&a.snippet.description&&(b.description=a.snippet.description),a.snippet.publishedAt&&(b.date=a.snippet.publishedAt),!a.thumb&&a.snippet.thumbnails&&(a.snippet.thumbnails.medium?b.thumb=a.snippet.thumbnails.medium.url:a.snippet.thumbnails.high?b.thumb=a.snippet.thumbnails.high.url:a.snippet.thumbnails["default"]&&
(b.thumb=a.snippet.thumbnails["default"].url)));if(a.contentDetails&&a.contentDetails.duration){var c=a.contentDetails.duration,d=c.match(/\d+/g);0<=c.indexOf("M")&&-1==c.indexOf("H")&&-1==c.indexOf("S")&&(d=[0,d[0],0]);0<=c.indexOf("H")&&-1==c.indexOf("M")&&(d=[d[0],0,d[1]]);0<=c.indexOf("H")&&-1==c.indexOf("M")&&-1==c.indexOf("S")&&(d=[d[0],0,0]);c=0;3==d.length&&(c+=3600*parseInt(d[0]),c+=60*parseInt(d[1]),c+=parseInt(d[2]));2==d.length&&(c+=60*parseInt(d[0]),c+=parseInt(d[1]));1==d.length&&(c+=
parseInt(d[0]));b.duration=c}return b}var r=this,g,k,h=[],n=50,l,f,m,u=p.youtubeAppId;this.resumeLoad=function(a){h=[];a?(l=a.substr(0,a.lastIndexOf("&pageToken=")),t(a)):q(r).trigger("HAPYoutubeLoader.END_LOAD",{data:h,nextPageToken:a})};this.setData=function(a){if(u){h=[];k=a;m=k.limit||400;n=50;m<n&&(n=m);g=k.type;f=null;var e="";-1<p.playlistItemContent.indexOf("title")&&(e+="title,");-1<p.playlistItemContent.indexOf("description")&&(e+="description,");-1<p.playlistItemContent.indexOf("date")&&
(e+="publishedAt,");-1<p.playlistItemContent.indexOf("thumb")&&(e+="thumbnails,");0<e.length?(e=e.substr(0,e.length-1),a=",snippet",e=",snippet("+e+")"):e=a="";if("youtube_single"==g||"youtube_single_list"==g){"youtube_single_list"==g&&(k.path=k.path.replace(/\s+/g,""));if(-1<p.playlistItemContent.indexOf("duration"))var b=",contentDetails",c=",contentDetails(duration)";else c=b="";l="https://www.googleapis.com/youtube/v3/videos?id="+k.path+"&key="+u+"&part=id"+a+b+"&fields=items(id"+e+c+")"}else"youtube_playlist"==
g&&(l="https://www.googleapis.com/youtube/v3/playlistItems?playlistId="+k.path+"&maxResults="+n+"&key="+u+"&part=contentDetails"+a+"&fields=items(contentDetails(videoId)"+e+"),nextPageToken");t(l)}else alert("Youtube API key missing! Set API key in settings.")};this.getNextPageToken=function(){return f}}})(window,jQuery);